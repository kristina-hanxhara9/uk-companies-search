<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Companies House Search</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-building" viewBox="0 0 16 16">
                    <path d="M4 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM4 5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zM7.5 5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zM4.5 8a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z"/>
                    <path d="M2 1a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1zm11 0H3v14h3v-2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5V15h3z"/>
                </svg>
                UK Companies Search
            </a>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Search Form -->
        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">Search Criteria</h5>
            </div>
            <div class="card-body">
                <form id="searchForm">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="sicCodes" class="form-label">SIC Codes</label>
                            <select id="sicCodes" class="form-select" multiple="multiple" style="width: 100%;">
                            </select>
                            <small class="text-muted">Optional: Select SIC codes to filter by industry</small>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="includeKeywords" class="form-label">Include Keywords (in company name)</label>
                            <input type="text" class="form-control" id="includeKeywords"
                                   placeholder="e.g., truck, tyre, tire">
                            <small class="text-muted">Comma-separated. Companies must contain at least one keyword.</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="excludeKeywords" class="form-label">Exclude Keywords (from company name)</label>
                            <input type="text" class="form-control" id="excludeKeywords"
                                   placeholder="e.g., car, cars">
                            <small class="text-muted">Comma-separated. Companies with these words will be excluded.</small>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="activeOnly" checked>
                                <label class="form-check-label" for="activeOnly">
                                    Active companies only
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="excludeNI" checked>
                                <label class="form-check-label" for="excludeNI">
                                    Exclude Northern Ireland
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includePeople">
                                <label class="form-check-label" for="includePeople">
                                    <strong>Include Directors & Owners</strong>
                                    <span class="badge bg-warning text-dark ms-1">Slower</span>
                                </label>
                                <br><small class="text-muted">Fetches officer and PSC data for each company</small>
                            </div>
                        </div>
                    </div>

                    <!-- Column Selector (Collapsible) -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="accordion column-accordion" id="columnAccordion">
                                <div class="accordion-item border-0 bg-transparent">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed px-0" type="button" data-bs-toggle="collapse" data-bs-target="#columnSelector" aria-expanded="false">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-columns-gap me-2" viewBox="0 0 16 16">
                                                <path d="M6 1v3H1V1zM1 0a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1zm14 12v3h-5v-3zm-5-1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1zM6 8v7H1V8zM1 7a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1zm14-6v7h-5V1zm-5-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1z"/>
                                            </svg>
                                            Columns to Display & Export
                                        </button>
                                    </h2>
                                    <div id="columnSelector" class="accordion-collapse collapse" data-bs-parent="#columnAccordion">
                                        <div class="accordion-body px-0 pt-3">
                            <div class="row">
                                <div class="col-md-3">
                                    <p class="column-section-title">Basic Info</p>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_company_number" data-column="company_number" checked>
                                        <label class="form-check-label small" for="col_company_number">Company Number</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_company_name" data-column="company_name" checked>
                                        <label class="form-check-label small" for="col_company_name">Company Name</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_company_status" data-column="company_status" checked>
                                        <label class="form-check-label small" for="col_company_status">Status</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_company_type" data-column="company_type" checked>
                                        <label class="form-check-label small" for="col_company_type">Type</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_date_of_creation" data-column="date_of_creation" checked>
                                        <label class="form-check-label small" for="col_date_of_creation">Date Created</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_date_of_cessation" data-column="date_of_cessation">
                                        <label class="form-check-label small" for="col_date_of_cessation">Date Ceased</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_jurisdiction" data-column="jurisdiction">
                                        <label class="form-check-label small" for="col_jurisdiction">Jurisdiction</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <p class="column-section-title">Address</p>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_full_address" data-column="full_address" checked>
                                        <label class="form-check-label small" for="col_full_address">Full Address</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_address_line_1" data-column="address_line_1">
                                        <label class="form-check-label small" for="col_address_line_1">Address Line 1</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_address_line_2" data-column="address_line_2">
                                        <label class="form-check-label small" for="col_address_line_2">Address Line 2</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_locality" data-column="locality">
                                        <label class="form-check-label small" for="col_locality">City/Town</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_region" data-column="region">
                                        <label class="form-check-label small" for="col_region">Region</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_postal_code" data-column="postal_code" checked>
                                        <label class="form-check-label small" for="col_postal_code">Postcode</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_country" data-column="country">
                                        <label class="form-check-label small" for="col_country">Country</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <p class="column-section-title">SIC Codes & Accounts</p>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_sic_codes" data-column="sic_codes" checked>
                                        <label class="form-check-label small" for="col_sic_codes">SIC Codes</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_sic_descriptions" data-column="sic_descriptions">
                                        <label class="form-check-label small" for="col_sic_descriptions">SIC Descriptions</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_accounts_overdue" data-column="accounts_overdue">
                                        <label class="form-check-label small" for="col_accounts_overdue">Accounts Overdue</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_last_accounts_date" data-column="last_accounts_date">
                                        <label class="form-check-label small" for="col_last_accounts_date">Last Accounts Date</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_next_accounts_due" data-column="next_accounts_due">
                                        <label class="form-check-label small" for="col_next_accounts_due">Next Accounts Due</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_confirmation_statement_overdue" data-column="confirmation_statement_overdue">
                                        <label class="form-check-label small" for="col_confirmation_statement_overdue">Confirmation Overdue</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <p class="column-section-title">Flags & Links</p>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_has_charges" data-column="has_charges">
                                        <label class="form-check-label small" for="col_has_charges">Has Charges</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_has_insolvency_history" data-column="has_insolvency_history">
                                        <label class="form-check-label small" for="col_has_insolvency_history">Insolvency History</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_has_been_liquidated" data-column="has_been_liquidated">
                                        <label class="form-check-label small" for="col_has_been_liquidated">Been Liquidated</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_previous_names" data-column="previous_names">
                                        <label class="form-check-label small" for="col_previous_names">Previous Names</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox" type="checkbox" id="col_companies_house_url" data-column="companies_house_url">
                                        <label class="form-check-label small" for="col_companies_house_url">Companies House URL</label>
                                    </div>
                                </div>
                            </div>
                            <!-- Directors & Owners section -->
                            <div class="row mt-2" id="peopleColumnsSection">
                                <div class="col-md-6">
                                    <p class="column-section-title">Directors <span class="badge bg-info">Requires checkbox above</span></p>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox people-column" type="checkbox" id="col_directors_count" data-column="directors_count">
                                        <label class="form-check-label small" for="col_directors_count">Directors Count</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox people-column" type="checkbox" id="col_directors_names" data-column="directors_names">
                                        <label class="form-check-label small" for="col_directors_names">Directors Names</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <p class="column-section-title">Owners (PSC) <span class="badge bg-info">Requires checkbox above</span></p>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox people-column" type="checkbox" id="col_psc_count" data-column="psc_count">
                                        <label class="form-check-label small" for="col_psc_count">Owners Count</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox people-column" type="checkbox" id="col_psc_names" data-column="psc_names">
                                        <label class="form-check-label small" for="col_psc_names">Owners Names</label>
                                    </div>
                                    <div class="form-check form-check-sm">
                                        <input class="form-check-input column-checkbox people-column" type="checkbox" id="col_psc_control" data-column="psc_control">
                                        <label class="form-check-label small" for="col_psc_control">Control Type</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="selectAllCols">Select All</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="deselectAllCols">Deselect All</button>
                                </div>
                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12 text-center">
                            <button type="submit" class="btn btn-primary btn-lg" id="searchBtn">
                                <span class="spinner-border spinner-border-sm d-none" id="searchSpinner"></span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search me-2" viewBox="0 0 16 16" id="searchIcon">
                                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                                </svg>
                                <span id="searchBtnText">Search Companies</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="d-none">
            <div class="card">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="mb-0">Results: <span id="resultCount" class="badge bg-success">0</span> companies</h5>
                    </div>
                    <div>
                        <button class="btn btn-success me-2" id="exportCsvBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-spreadsheet me-1" viewBox="0 0 16 16">
                                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V9H3V2a1 1 0 0 1 1-1h5.5zM3 12v-2h2v2zm0 1h2v2H4a1 1 0 0 1-1-1zm3 2v-2h3v2zm4 0v-2h3v1a1 1 0 0 1-1 1zm3-3h-3v-2h3zm-7 0v-2h3v2z"/>
                            </svg>
                            Export CSV
                        </button>
                        <button class="btn btn-primary" id="exportExcelBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-excel me-1" viewBox="0 0 16 16">
                                <path d="M5.884 6.68a.5.5 0 1 0-.768.64L7.349 10l-2.233 2.68a.5.5 0 0 0 .768.64L8 10.781l2.116 2.54a.5.5 0 0 0 .768-.641L8.651 10l2.233-2.68a.5.5 0 0 0-.768-.64L8 9.219l-2.116-2.54z"/>
                                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                            </svg>
                            Export Excel
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="companiesTable" class="table table-striped table-hover" style="width:100%">
                            <thead>
                                <tr>
                                    <th>Company Number</th>
                                    <th>Company Name</th>
                                    <th>Status</th>
                                    <th>Type</th>
                                    <th>Created</th>
                                    <th>SIC Codes</th>
                                    <th>SIC Descriptions</th>
                                    <th>Address</th>
                                    <th>Postcode</th>
                                    <th>Region</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="d-none">
            <div class="loading-content">
                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 mb-0" id="loadingText">Searching Companies House API...</p>
                <small class="text-muted">This may take a few moments depending on the number of results</small>
            </div>
        </div>
    </div>

    <footer class="bg-light py-3 mt-5">
        <div class="container text-center text-muted">
            <small>Data sourced from Companies House API</small>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <!-- App JS -->
    <script src="js/sic_codes.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
